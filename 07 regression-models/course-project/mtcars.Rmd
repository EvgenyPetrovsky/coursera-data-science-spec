---
title: "Regression Models Course Project"
author: "Evgeny Petrovskiy"
date: "11/18/2017"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
require(ggplot2)

```
## Summary

Goal of this assignment is to analyze `mtcars` dataset and answer two questions:

* "Is an automatic or manual transmission better for MPG"
* "Quantify the MPG difference between automatic and manual transmissions"

In order to answe rthis questions we apply different techniques Below: first we do exploratory analysis, then we apply regression models and assess their quality, finally we are trying to answer questions based on information we gathered.

## first look at data

`mtcars` is a data frame with 32 observations that include 11 different measurements. Below is desription of columns for  dataset: 

1.	`mpg`	Miles/(US) gallon
2.	`cyl`	Number of cylinders
3.	`disp`	Displacement (cu.in.)
4.	`hp`	Gross horsepower
5.	`drat`	Rear axle ratio
6.	`wt`	Weight (1000 lbs)
7.	`qsec`	1/4 mile time
8.	`vs`	V/S
9.	`am`	Transmission (0 = automatic, 1 = manual)
10.	`gear`	Number of forward gears
11.	`carb`	Number of carburetors


```{r mtcars}
str(mtcars)
```

## Exploratory analysys

Appendix I shows relation bewteen MPG and all other variables of the dataset. Looking at that data we can make a conclusion that *mpg* value correlates with *wt*, *disp*, *hp*

let's look at them on logarirhmic scale
```{r "closelook"}
for (i in c("disp", "hp", "wt")) {
  plot(
    log(mtcars$mpg) ~ mtcars[, i],
    col = factor(mtcars$am), pch = 19, xlab = i,
    main = paste("logarithmic relation between MPG and", toupper(i), sep = " ")
  )
}
```

Following correlations look very strong 

* `Miles per galon` and `Wieght`
* `Miles per galon` and `Displacement`

Relation bewteen displacement & horse powers

```{r rel-disp-hp}
plot(hp ~ disp, data = mtcars, main = "Relation between horse-powers and displacement")
```

Let's build models that involve transmission type (`am`), displacement (`disp`) and horse powers (`hp`) as regressors and perform anova test. 

``` {r "models"}
fit1 <- lm(log(mpg) ~ wt, data = mtcars)
fit2 <- lm(log(mpg) ~ wt + disp, data = mtcars)
fit3 <- lm(log(mpg) ~ wt + disp + hp, data = mtcars)
fit.all <- lm(log(mpg) ~ ., data = mtcars)

anova(fit1, fit2, fit3, fit.all)
```

Anova test shows that after considering `wt` model can be slightly improved with `disp` and `hp` but other regressors doesn't make model significantly better.

now let's make separate models for manual and automatic transmissions

```{r am-models}
fitA <- lm(log(mpg) ~ wt, data = subset(mtcars, am == 0))
fitM <- lm(log(mpg) ~ wt, data = subset(mtcars, am == 1))

plot(log(mpg) ~ wt, col = factor(am), data = mtcars, pch = 18,
     main = "Regression lines for Auto and Manual transmissions")
#plot(exp(fitA$fitted.values) ~ subset(mtcars, am == 0)$wt)
abline(fitA, col = 1)
abline(fitM, col = 2)
```

# Appendices

## Appendix I

```{r "explore"}
cols <- names(mtcars)
cols <- cols[!cols %in% c("mpg")]
par(mfrow = c(1,1))
# sapply(X = cols, FUN = plotx)
for (x in cols) {
  plot(
    mtcars$mpg ~ mtcars[,x], 
    col = factor(mtcars$am), 
    pch = 19, 
    xlab = x, ylab = "mpg"
  ) 
}

```
